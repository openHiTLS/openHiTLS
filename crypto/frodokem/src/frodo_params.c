/*
 * This file is part of the openHiTLS project.
 *
 * openHiTLS is licensed under the Mulan PSL v2.
 * You can use this software according to the terms and conditions of the Mulan PSL v2.
 * You may obtain a copy of Mulan PSL v2 at:
 *
 *     http://license.coscl.org.cn/MulanPSL2
 *
 * THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
 * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
 * MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
 * See the Mulan PSL v2 for more details.
 */

#include "hitls_build.h"
#ifdef HITLS_CRYPTO_FRODOKEM
#include <stddef.h>

#include "frodo_local.h"
#include "crypt_algid.h"

#define FRODOKEM_PARA_NUM 12

static const uint16_t g_cdfTable640[] = {4643,  13363, 20579, 25843, 29227, 31145, 32103,
                                         32525, 32689, 32745, 32762, 32766, 32767};
static const uint16_t g_cdfTable976[] = {5638, 15915, 23689, 28571, 31116, 32217, 32613, 32731, 32760, 32766, 32767};
static const uint16_t g_cdfTable1344[] = {9142, 23462, 30338, 32361, 32725, 32765, 32767};

static FrodoKemParams g_allFrodoParams[FRODOKEM_PARA_NUM] = {
    /* [FRODOKEM_640_SHAKE] */
    {.algId = CRYPT_KEM_TYPE_FRODOKEM_640_SHAKE,
     .n = 640,
     .nBar = 8,
     .logq = 15,
     .extractedBits = 2,
     .d = 12,
     .pkSize = 9616,
     .kemSkSize = 19888,
     .ctxSize = 9752,
     .ss = 16,
     .lenSeedA = 16,
     .lenSeedSE = 32,
     .lenSalt = 32,
     .lenMu = 16,
     .lenPkHash = 16,
     .cdfTable = g_cdfTable640,
     .cdfLen = 13,
     .prg = FRODO_PRG_SHAKE},
    /* [FRODOKEM_976_SHAKE] */
    {.algId = CRYPT_KEM_TYPE_FRODOKEM_976_SHAKE,
     .n = 976,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 3,
     .d = 10,
     .pkSize = 15632,
     .kemSkSize = 31296,
     .ctxSize = 15792,
     .ss = 24,
     .lenSeedA = 16,
     .lenSeedSE = 48,
     .lenSalt = 48,
     .lenMu = 24,
     .lenPkHash = 24,
     .cdfTable = g_cdfTable976,
     .cdfLen = 11,
     .prg = FRODO_PRG_SHAKE},
    /* [FRODOKEM_1344_SHAKE] */
    {.algId = CRYPT_KEM_TYPE_FRODOKEM_1344_SHAKE,
     .n = 1344,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 4,
     .d = 6,
     .pkSize = 21520,
     .kemSkSize = 43088,
     .ctxSize = 21696,
     .ss = 32,
     .lenSeedA = 16,
     .lenSeedSE = 64,
     .lenSalt = 64,
     .lenMu = 32,
     .lenPkHash = 32,
     .cdfTable = g_cdfTable1344,
     .cdfLen = 7,
     .prg = FRODO_PRG_SHAKE},
    /* [FRODOKEM_640_AES] */
    {.algId = CRYPT_KEM_TYPE_FRODOKEM_640_AES,
     .n = 640,
     .nBar = 8,
     .logq = 15,
     .extractedBits = 2,
     .d = 12,
     .pkSize = 9616,
     .kemSkSize = 19888,
     .ctxSize = 9752,
     .ss = 16,
     .lenSeedA = 16,
     .lenSeedSE = 32,
     .lenSalt = 32,
     .lenMu = 16,
     .lenPkHash = 16,
     .cdfTable = g_cdfTable640,
     .cdfLen = 13,
     .prg = FRODO_PRG_AES},
    /* [FRODOKEM_976_AES] */
    {.algId = CRYPT_KEM_TYPE_FRODOKEM_976_AES,
     .n = 976,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 3,
     .d = 10,
     .pkSize = 15632,
     .kemSkSize = 31296,
     .ctxSize = 15792,
     .ss = 24,
     .lenSeedA = 16,
     .lenSeedSE = 48,
     .lenSalt = 48,
     .lenMu = 24,
     .lenPkHash = 24,
     .cdfTable = g_cdfTable976,
     .cdfLen = 11,
     .prg = FRODO_PRG_AES},
    /* [FRODOKEM_1344_AES] */
    {.algId = CRYPT_KEM_TYPE_FRODOKEM_1344_AES,
     .n = 1344,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 4,
     .d = 6,
     .pkSize = 21520,
     .kemSkSize = 43088,
     .ctxSize = 21696,
     .ss = 32,
     .lenSeedA = 16,
     .lenSeedSE = 64,
     .lenSalt = 64,
     .lenMu = 32,
     .lenPkHash = 32,
     .cdfTable = g_cdfTable1344,
     .cdfLen = 7,
     .prg = FRODO_PRG_AES},
    /* [eFRODOKEM_640_SHAKE] */
    {.algId = CRYPT_KEM_TYPE_eFRODOKEM_640_SHAKE,
     .n = 640,
     .nBar = 8,
     .logq = 15,
     .extractedBits = 2,
     .d = 12,
     .pkSize = 9616,
     .kemSkSize = 19888,
     .ctxSize = 9720,
     .ss = 16,
     .lenSeedA = 16,
     .lenSeedSE = 16,
     .lenSalt = 0,
     .lenMu = 16,
     .lenPkHash = 16,
     .cdfTable = g_cdfTable640,
     .cdfLen = 13,
     .prg = FRODO_PRG_SHAKE},
    /* [eFRODOKEM_976_SHAKE] */
    {.algId = CRYPT_KEM_TYPE_eFRODOKEM_976_SHAKE,
     .n = 976,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 3,
     .d = 10,
     .pkSize = 15632,
     .kemSkSize = 31296,
     .ctxSize = 15744,
     .ss = 24,
     .lenSeedA = 16,
     .lenSeedSE = 24,
     .lenSalt = 0,
     .lenMu = 24,
     .lenPkHash = 24,
     .cdfTable = g_cdfTable976,
     .cdfLen = 11,
     .prg = FRODO_PRG_SHAKE},
    /* [eFRODOKEM_1344_SHAKE] */
    {.algId = CRYPT_KEM_TYPE_eFRODOKEM_1344_SHAKE,
     .n = 1344,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 4,
     .d = 6,
     .pkSize = 21520,
     .kemSkSize = 43088,
     .ctxSize = 21632,
     .ss = 32,
     .lenSeedA = 16,
     .lenSeedSE = 32,
     .lenSalt = 0,
     .lenMu = 32,
     .lenPkHash = 32,
     .cdfTable = g_cdfTable1344,
     .cdfLen = 7,
     .prg = FRODO_PRG_SHAKE},
    /* [eFRODOKEM_640_AES] */
    {.algId = CRYPT_KEM_TYPE_eFRODOKEM_640_AES,
     .n = 640,
     .nBar = 8,
     .logq = 15,
     .extractedBits = 2,
     .d = 12,
     .pkSize = 9616,
     .kemSkSize = 19888,
     .ctxSize = 9720,
     .ss = 16,
     .lenSeedA = 16,
     .lenSeedSE = 16,
     .lenSalt = 0,
     .lenMu = 16,
     .lenPkHash = 16,
     .cdfTable = g_cdfTable640,
     .cdfLen = 13,
     .prg = FRODO_PRG_AES},
    /* [eFRODOKEM_976_AES] */
    {.algId = CRYPT_KEM_TYPE_eFRODOKEM_976_AES,
     .n = 976,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 3,
     .d = 10,
     .pkSize = 15632,
     .kemSkSize = 31296,
     .ctxSize = 15744,
     .ss = 24,
     .lenSeedA = 16,
     .lenSeedSE = 24,
     .lenSalt = 0,
     .lenMu = 24,
     .lenPkHash = 24,
     .cdfTable = g_cdfTable976,
     .cdfLen = 11,
     .prg = FRODO_PRG_AES},
    /* [eFRODOKEM_1344_AES] */
    {.algId = CRYPT_KEM_TYPE_eFRODOKEM_1344_AES,
     .n = 1344,
     .nBar = 8,
     .logq = 16,
     .extractedBits = 4,
     .d = 6,
     .pkSize = 21520,
     .kemSkSize = 43088,
     .ctxSize = 21632,
     .ss = 32,
     .lenSeedA = 16,
     .lenSeedSE = 32,
     .lenSalt = 0,
     .lenMu = 32,
     .lenPkHash = 32,
     .cdfTable = g_cdfTable1344,
     .cdfLen = 7,
     .prg = FRODO_PRG_AES},
};

FrodoKemParams *FrodoGetParamsById(int32_t algId)
{
    if (algId >= CRYPT_KEM_TYPE_FRODOKEM_640_SHAKE && algId <= CRYPT_KEM_TYPE_eFRODOKEM_1344_AES) {
        return &g_allFrodoParams[algId - CRYPT_KEM_TYPE_FRODOKEM_640_SHAKE];
    }
    return NULL;
}
#endif
